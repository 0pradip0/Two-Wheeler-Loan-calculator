<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Two‑Wheeler EMI Calculator — Single File</title>

  <!-- Font Awesome (icons) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

  <!-- Chart.js (for comparison chart) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.umd.min.js"></script>

  <style>
    :root{
      --bg: #eef4f8;
      --card: #ffffff;
      --muted: #6b7280;
      --text: #0f1724;
      --accent: #0b1728; /* deep dark for active tab / CTA */
      --accent-2: #ff7a18;
      --green: #16a34a;
      --orange: #ef6c2f;
      --danger: #ef4444;
      --radius: 16px;
      --shadow: 0 12px 30px rgba(16,24,40,0.06);
      --glass-border: rgba(2,6,23,0.03);
    }

    /* Dark theme overrides */
    body.dark-theme{
      --bg:#071023;
      --card: rgba(12,18,28,0.9);
      --muted:#93a5b8;
      --text:#e6eef8;
      --accent:#0b1728;
      --glass: rgba(255,255,255,0.02);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: var(--bg);
      color:var(--text);
      -webkit-font-smoothing:antialiased;
      padding:28px;
      line-height:1.35;
      margin:0;
    }

    /* container */
    .container{
      max-width:1100px;
      margin:0 auto;
    }

    /* topbar */
    .topbar{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      margin-bottom:18px;
    }
    .brand{display:flex;align-items:center;gap:12px}
    .brand i{font-size:22px;color:var(--accent-2)}
    .brand h1{font-size:18px;font-weight:700;color:var(--text);margin:0}
    .icon-btn{
      width:44px;height:44px;border-radius:10px;border:0;background:transparent;color:var(--muted);cursor:pointer;
    }
    .icon-btn:hover{transform:translateY(-3px)}

    /* tabs */
    .tabs{
      display:flex;
      gap:12px;
      margin:12px 0 18px;
    }
    .tab{
      flex:1;
      padding:14px 18px;
      border-radius:12px;
      background:transparent;
      border:1px solid transparent;
      color:var(--muted);
      font-weight:700;
      cursor:pointer;
      box-shadow:none;
      text-align:center;
    }
    .tab.active{
      background:var(--accent);
      color:white;
      box-shadow:0 10px 30px rgba(2,6,23,0.08);
      transform:translateY(-2px);
    }

    /* main */
    .main{display:flex;flex-direction:column;gap:20px}

    /* card */
    .card{
      background:var(--card);
      border-radius:var(--radius);
      padding:18px;
      box-shadow:var(--shadow);
      border:1px solid var(--glass-border);
    }

    /* input card */
    .input-card .card-inner{display:flex;flex-direction:column;gap:14px}
    .form-row{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    .field{display:flex;flex-direction:column;gap:6px}
    .label{font-size:12px;color:var(--muted);font-weight:700;letter-spacing:0.6px}
    .field input[type="number"]{
      padding:12px 14px;border-radius:10px;border:1px solid rgba(2,6,23,0.06);font-size:15px;background:transparent;color:var(--text)
    }
    .field input[type="number"]:focus{outline:none;box-shadow:0 8px 24px rgba(2,6,23,0.06)}

    /* dynamic single input (for EMI / reducing / flat) */
    .active-input { margin-top:4px; display:flex; gap:12px; align-items:center; }
    .active-input .field { flex:1 }
    .active-input .helper { font-size:13px; color:var(--muted); font-weight:600; white-space:nowrap; }

    /* chips */
    .chips-wrap{display:flex;gap:12px;margin-top:4px;align-items:stretch}
    .chip{
      flex:1;
      background:linear-gradient(180deg, rgba(255,255,255,0.98), rgba(255,255,255,0.95));
      border-radius:10px;padding:14px;position:relative;border:1px solid var(--glass-border);
      display:flex;flex-direction:column;gap:6px;align-items:flex-start;
      min-height:72px;
    }
    .chip-title{font-size:11px;color:var(--muted);font-weight:700;letter-spacing:0.6px}
    .chip-value{font-size:20px;font-weight:800;color:var(--text)}
    .chip-value.green{color:var(--green)}
    .chip-value.orange{color:var(--orange)}
    .chip-tag{position:absolute;right:10px;top:12px;font-size:11px;padding:6px 8px;border-radius:6px;background:rgba(0,0,0,0.04);color:var(--muted);font-weight:700}
    .chip .input-tag{background:linear-gradient(90deg,rgba(239,108,47,0.12),rgba(255,122,24,0.08));color:var(--orange)}

    /* CTA */
    .cta-row{margin-top:8px;display:flex}
    .cta{width:100%;padding:16px;border-radius:14px;border:0;background:linear-gradient(90deg,var(--accent),#0b1220);color:white;font-weight:800;font-size:16px;cursor:pointer;box-shadow:0 16px 40px rgba(2,6,23,0.12)}
    .cta i{margin-left:8px}

    /* summary grid */
    .summary-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:16px}
    .summary-card{padding:18px;border-radius:12px;background:linear-gradient(180deg,rgba(255,255,255,0.98),transparent);border:1px solid var(--glass-border)}
    .summary-title{font-size:12px;color:var(--muted);font-weight:800;margin-bottom:12px}
    .summary-row{display:flex;justify-content:space-between;padding:10px 0;border-top:1px solid rgba(2,6,23,0.03)}
    .summary-row:first-of-type{border-top:none}
    .summary-row strong{font-weight:800}
    .summary-row.danger strong{color:var(--danger)}

    /* results section / chart */
    .results-section{margin-top:8px}
    .chart-card{padding:12px}
    .hidden{display:none}

    /* modal */
    .modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(2,6,23,0.4);visibility:hidden;opacity:0;transition:all .18s}
    .modal[aria-hidden="false"]{visibility:visible;opacity:1}
    .modal-inner{width:94%;max-width:920px;border-radius:12px}
    .modal-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    .table-wrap{max-height:50vh;overflow:auto}
    table{width:100%;border-collapse:collapse}
    thead th{position:sticky;top:0;background:var(--card);padding:10px;text-align:right}
    tbody td{padding:10px;text-align:right;border-top:1px solid rgba(2,6,23,0.03)}
    tbody td:first-child, thead th:first-child{text-align:left}

    /* small helpers */
    .muted{color:var(--muted);font-size:13px}
    .center{text-align:center}

    /* responsive */
    @media (max-width: 920px){
      .form-row{grid-template-columns:1fr}
      .chips-wrap{flex-direction:column}
      .summary-grid{grid-template-columns:1fr}
      .container{padding:18px}
    }
    @media (max-width:480px){
      .cta{padding:14px;font-size:15px}
    }
  </style>
</head>
<body>
  <div class="container">
    <header class="topbar">
      <div class="brand">
        <i class="fa-solid fa-motorcycle"></i>
        <h1>Two‑Wheeler EMI Calculator</h1>
      </div>
      <div class="top-controls">
        <button id="themeToggle" class="icon-btn" aria-label="Toggle theme"><i class="fa-solid fa-moon"></i></button>
      </div>
    </header>

    <div class="tabs" role="tablist" aria-label="Input mode">
      <button class="tab" data-mode="emi">Input EMI</button>
      <button class="tab" data-mode="reducing">Input Reducing %</button>
      <button class="tab active" data-mode="flat">Input Flat %</button>
    </div>

    <main class="main">
      <!-- Input Card -->
      <section class="card input-card" aria-labelledby="inputCardTitle">
        <div class="card-inner">
          <div class="form-row">
            <label class="field">
              <span class="label">On‑Road Price</span>
              <input id="onRoadPrice" type="number" min="0" step="100" value="111577" />
            </label>

            <label class="field">
              <span class="label">Down Payment</span>
              <input id="downPayment" type="number" min="0" step="100" value="65177" />
            </label>

            <label class="field">
              <span class="label">Tenure (months)</span>
              <input id="tenure" type="number" min="1" max="240" step="1" value="23" />
            </label>
          </div>

          <!-- Active single input that adapts with tab -->
          <div class="active-input" id="activeInputRow">
            <label class="field" style="flex:1">
              <span class="label" id="activeInputLabel">Flat Rate (%)</span>
              <input id="activeInput" type="number" min="0" step="0.01" placeholder="Enter flat rate" value="13.5" />
            </label>
            <div class="helper muted">Enter the value for the active tab</div>
          </div>

          <div class="chips-wrap" aria-hidden="false">
            <div class="chip" data-chip="emi" title="View amortization (reducing) by clicking">
              <div class="chip-title">MONTHLY EMI (₹)</div>
              <div id="chipEmi" class="chip-value">—</div>
              <div class="chip-tag">RESULT</div>
            </div>

            <div class="chip" data-chip="reducing" title="View amortization (reducing) by clicking">
              <div class="chip-title">REDUCING RATE (%)</div>
              <div id="chipReducing" class="chip-value green">—</div>
              <div class="chip-tag">RESULT</div>
            </div>

            <div class="chip" data-chip="flat" title="View amortization (flat) by clicking">
              <div class="chip-title">FLAT RATE (%)</div>
              <div id="chipFlat" class="chip-value orange">—</div>
              <div class="chip-tag input-tag" id="inputTag">INPUT</div>
            </div>
          </div>

          <div class="cta-row">
            <button id="calculateBtn" class="cta">Calculate All <i class="fa-solid fa-arrow-right"></i></button>
          </div>
        </div>
      </section>

      <!-- Results / Summary -->
      <section class="summary-grid" aria-live="polite">
        <div class="summary-card">
          <div class="summary-title">Financial Breakdown</div>
          <div class="summary-row"><span>Loan Principal</span><strong id="summaryPrincipal">—</strong></div>
          <div class="summary-row"><span>Total Repayment</span><strong id="summaryTotal">—</strong></div>
          <div class="summary-row danger"><span>Total Interest Cost</span><strong id="summaryInterest">—</strong></div>
        </div>

        <div class="summary-card">
          <div class="summary-title">Calculation Method</div>
          <div class="method-text" id="calcMethod">Based on Flat Rate input.</div>
        </div>
      </section>

      <!-- Chart & Details -->
      <section id="resultsSection" class="results-section hidden">
        <div class="chart-card card">
          <h3 style="margin:0 0 12px 0">Comparison</h3>
          <div style="height:220px;">
            <canvas id="comparisonChart"></canvas>
          </div>
        </div>
      </section>
    </main>

    <footer class="footer muted center" style="margin-top:18px">© 2026 Two‑Wheeler EMI Calculator</footer>
  </div>

  <!-- Breakdown Modal -->
  <div id="breakdownModal" class="modal" aria-hidden="true">
    <div class="modal-inner card">
      <div class="modal-head">
        <h3 id="modalRateType">Amortization Schedule</h3>
        <button id="closeModal" class="icon-btn" aria-label="Close modal"><i class="fa-solid fa-xmark"></i></button>
      </div>
      <div class="modal-body">
        <div class="table-wrap">
          <table id="amortizationTable">
            <thead><tr><th>Month</th><th>EMI</th><th>Principal</th><th>Interest</th><th>Balance</th></tr></thead>
            <tbody id="tableBody"></tbody>
          </table>
        </div>
      </div>
      <div class="modal-foot" style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
        <button id="downloadBtn" class="icon-btn secondary-btn" style="padding:8px 12px;border-radius:8px;border:1px solid var(--glass-border);background:transparent">Download CSV</button>
        <button id="closeModalBtn" class="icon-btn" style="padding:8px 12px;border-radius:8px;border:1px solid var(--glass-border);background:transparent">Close</button>
      </div>
    </div>
  </div>

  <script>
    // Single-file EMI calculator script
    (function(){
      // Elements
      const tabs = Array.from(document.querySelectorAll('.tab'));
      const onRoadEl = document.getElementById('onRoadPrice');
      const downEl = document.getElementById('downPayment');
      const tenureEl = document.getElementById('tenure');
      const activeLabel = document.getElementById('activeInputLabel');
      const activeInput = document.getElementById('activeInput');
      const chipEmi = document.getElementById('chipEmi');
      const chipReducing = document.getElementById('chipReducing');
      const chipFlat = document.getElementById('chipFlat');
      const inputTag = document.getElementById('inputTag');
      const calculateBtn = document.getElementById('calculateBtn');
      const resultsSection = document.getElementById('resultsSection');
      const summaryPrincipal = document.getElementById('summaryPrincipal');
      const summaryTotal = document.getElementById('summaryTotal');
      const summaryInterest = document.getElementById('summaryInterest');
      const calcMethod = document.getElementById('calcMethod');
      const comparisonCanvas = document.getElementById('comparisonChart');

      // Modal & schedule
      const modal = document.getElementById('breakdownModal');
      const closeModal = document.getElementById('closeModal');
      const closeModalBtn = document.getElementById('closeModalBtn');
      const tableBody = document.getElementById('tableBody');
      const modalRateType = document.getElementById('modalRateType');

      // Theme
      const themeToggle = document.getElementById('themeToggle');
      if (localStorage.getItem('theme') === 'dark') {
        document.body.classList.add('dark-theme');
        themeToggle.innerHTML = '<i class="fa-solid fa-sun"></i>';
      } else {
        themeToggle.innerHTML = '<i class="fa-solid fa-moon"></i>';
      }
      themeToggle.addEventListener('click', () => {
        const dark = document.body.classList.toggle('dark-theme');
        localStorage.setItem('theme', dark ? 'dark' : 'light');
        themeToggle.innerHTML = dark ? '<i class="fa-solid fa-sun"></i>' : '<i class="fa-solid fa-moon"></i>';
        if (chart) chart.update();
      });

      // State
      let mode = 'flat'; // 'emi' | 'reducing' | 'flat'
      let chart = null;
      let lastResults = null;

      // Initialize: set active tab and label
      function setMode(m) {
        mode = m;
        tabs.forEach(t => t.classList.toggle('active', t.dataset.mode === m));
        if (m === 'flat') {
          activeLabel.textContent = 'Flat Rate (%)';
          activeInput.placeholder = 'Enter flat annual rate (e.g. 13.5)';
          inputTag.textContent = 'INPUT';
        } else if (m === 'reducing') {
          activeLabel.textContent = 'Reducing Rate (%)';
          activeInput.placeholder = 'Enter reducing annual rate (e.g. 24.12)';
          inputTag.textContent = 'RESULT';
        } else {
          activeLabel.textContent = 'Monthly EMI (₹)';
          activeInput.placeholder = 'Enter monthly EMI (e.g. 2539)';
          inputTag.textContent = 'RESULT';
        }
        // clear chips until calculate
        chipEmi.textContent = '—';
        chipReducing.textContent = '—';
        chipFlat.textContent = '—';
        resultsSection.classList.add('hidden');
        lastResults = null;
      }

      tabs.forEach(t => t.addEventListener('click', () => setMode(t.dataset.mode)));
      setMode('flat'); // default

      // Utilities
      const fmtCurr = v => '₹' + Number(v || 0).toLocaleString('en-IN', {maximumFractionDigits:0});
      function clampDownPayment() {
        const onRoad = Number(onRoadEl.value) || 0;
        let down = Number(downEl.value) || 0;
        if (down > onRoad) { downEl.value = onRoad; down = onRoad; }
        return down;
      }

      // Conversions & calculations
      function flatToReducing(flat, months) {
        // approximation: reducing ≈ (2 × flat) / (months + 1)
        return (2 * flat) / (months + 1);
      }
      function reducingToFlat(reducing, months) {
        // inverse approximation
        return (reducing * (months + 1)) / 2;
      }

      function computeReducingEMI(P, annualRate, n){
        const r = (annualRate / 100) / 12;
        if (!r) return P / n;
        const num = P * r * Math.pow(1 + r, n);
        const den = Math.pow(1 + r, n) - 1;
        return num / den;
      }

      // Solve monthly rate given P, target EMI and tenure using binary search
      function solveMonthlyRate(P, emi, n){
        if (emi <= P / n) return 0;
        let lo = 0, hi = 1, mid;
        for (let i = 0; i < 80; i++){
          mid = (lo + hi) / 2;
          const calc = (P * mid * Math.pow(1+mid, n)) / (Math.pow(1+mid, n)-1);
          if (calc > emi) hi = mid; else lo = mid;
        }
        return (lo + hi) / 2;
      }

      // Core calculate function (reads activeInput according to mode)
      function calculateAll() {
        clampDownPayment();
        const onRoad = Number(onRoadEl.value) || 0;
        const down = Number(downEl.value) || 0;
        const P = Math.max(0, onRoad - down);
        const n = Math.max(1, parseInt(tenureEl.value, 10) || 1);
        const years = n / 12;

        const userVal = Number(activeInput.value) || 0;

        let flatAnnual, reducingAnnual, flatEMI, reducingEMI, flatTotalInterest, reducingTotalInterest;

        if (mode === 'flat') {
          flatAnnual = userVal;
          reducingAnnual = flatToReducing(flatAnnual, n);
          flatTotalInterest = P * (flatAnnual / 100) * years;
          flatEMI = (P + flatTotalInterest) / n;
          reducingEMI = computeReducingEMI(P, reducingAnnual, n);
          reducingTotalInterest = reducingEMI * n - P;
          calcMethod.textContent = 'Based on Flat Rate input.';
        } else if (mode === 'reducing') {
          reducingAnnual = userVal;
          flatAnnual = reducingToFlat(reducingAnnual, n);
          reducingEMI = computeReducingEMI(P, reducingAnnual, n);
          reducingTotalInterest = reducingEMI * n - P;
          flatTotalInterest = P * (flatAnnual / 100) * years;
          flatEMI = (P + flatTotalInterest) / n;
          calcMethod.textContent = 'Based on Reducing Rate input.';
        } else { // emi mode
          const userEmi = userVal;
          // solve for monthly rate
          const monthlyRate = solveMonthlyRate(P, userEmi, n);
          reducingAnnual = monthlyRate * 12 * 100;
          reducingEMI = userEmi;
          flatAnnual = reducingToFlat(reducingAnnual, n);
          reducingTotalInterest = reducingEMI * n - P;
          flatTotalInterest = P * (flatAnnual / 100) * years;
          flatEMI = (P + flatTotalInterest) / n;
          calcMethod.textContent = 'Based on EMI input.';
        }

        // Build results object
        const results = {
          principal: P,
          tenure: n,
          flatAnnual: Number(flatAnnual || 0),
          reducingAnnual: Number(reducingAnnual || 0),
          flatEMI: Number(flatEMI || 0),
          reducingEMI: Number(reducingEMI || 0),
          flatTotalInterest: Number(flatTotalInterest || 0),
          reducingTotalInterest: Number(reducingTotalInterest || 0),
        };

        // Update UI
        chipEmi.textContent = Math.round(results.reducingEMI).toLocaleString('en-IN');
        chipReducing.textContent = results.reducingAnnual.toFixed(2);
        chipFlat.textContent = results.flatAnnual.toFixed(2);
        inputTag.textContent = (mode === 'flat') ? 'INPUT' : 'RESULT';

        summaryPrincipal.textContent = fmtCurr(results.principal);
        // Choose total repayment to show: use reducing as primary for EMI chip
        const totalRepay = Math.max(results.flatEMI * n, results.reducingEMI * n);
        summaryTotal.textContent = fmtCurr(totalRepay);
        // show interest (flat interest highlighted if flat input, else show reducing interest)
        summaryInterest.textContent = fmtCurr( mode === 'flat' ? results.flatTotalInterest : results.reducingTotalInterest );

        resultsSection.classList.remove('hidden');

        // store last results
        lastResults = { ...results, totalRepay };

        renderChart(lastResults);
      }

      // Chart rendering
      function renderChart(res) {
        const labels = ['Monthly EMI','Total Interest','Total Payable'];
        const flatTotalPayable = res.flatEMI * res.tenure;
        const reducingTotalPayable = res.reducingEMI * res.tenure;
        const flatInt = res.flatTotalInterest;
        const reducingInt = res.reducingTotalInterest;

        if (chart) chart.destroy();
        chart = new Chart(comparisonCanvas.getContext('2d'), {
          type:'bar',
          data:{
            labels,
            datasets:[
              { label:`Flat (${res.flatAnnual.toFixed(2)}%)`, data:[res.flatEMI, flatInt, flatTotalPayable], backgroundColor:'#ff8a3d' },
              { label:`Reducing (${res.reducingAnnual.toFixed(2)}%)`, data:[res.reducingEMI, reducingInt, reducingTotalPayable], backgroundColor:'#16a34a' }
            ]
          },
          options:{
            responsive:true,
            maintainAspectRatio:false,
            plugins:{ legend:{ labels:{ color: getComputedStyle(document.body).color } } },
            scales:{ y:{ ticks:{ callback:v => '₹' + Number(v).toLocaleString() } } }
          }
        });
      }

      // Amortization schedules
      function generateFlatSchedule(res) {
        const { principal, tenure, flatEMI, flatTotalInterest } = res;
        const monthlyInterest = (flatTotalInterest || 0) / tenure;
        let remaining = principal;
        const schedule = [];
        for (let m=1; m<=tenure; m++){
          const interest = monthlyInterest;
          const principalPaid = Math.min(remaining, flatEMI - interest);
          remaining = Math.max(0, remaining - principalPaid);
          schedule.push({ month:m, emi:flatEMI, principal:principalPaid, interest, balance:remaining });
        }
        return schedule;
      }
      function generateReducingSchedule(res) {
        const { principal, tenure, reducingEMI, reducingAnnual } = res;
        const r = (reducingAnnual / 100) / 12;
        let remaining = principal;
        const schedule = [];
        for (let m=1; m<=tenure; m++){
          const interest = remaining * r;
          const principalPaid = reducingEMI - interest;
          remaining = Math.max(0, remaining - principalPaid);
          schedule.push({ month:m, emi:reducingEMI, principal:principalPaid, interest, balance:remaining });
        }
        return schedule;
      }

      // Open schedule modal for flat or reducing depending on chip clicked
      document.querySelectorAll('.chip').forEach(ch => {
        ch.addEventListener('click', (e) => {
          if (!lastResults) return;
          const type = ch.dataset.chip === 'flat' ? 'flat' : 'reducing';
          openSchedule(type);
        });
      });

      function openSchedule(type) {
        if (!lastResults) return;
        modal.setAttribute('aria-hidden','false');
        modalRateType.textContent = (type === 'flat') ? 'Flat Rate Schedule' : 'Reducing Rate Schedule';
        tableBody.innerHTML = '';
        const schedule = (type === 'flat') ? generateFlatSchedule(lastResults) : generateReducingSchedule(lastResults);
        schedule.forEach(r => {
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${r.month}</td>
                          <td style="text-align:right">${Number(r.emi).toFixed(2)}</td>
                          <td style="text-align:right">${Number(r.principal).toFixed(2)}</td>
                          <td style="text-align:right">${Number(r.interest).toFixed(2)}</td>
                          <td style="text-align:right">${Number(r.balance).toFixed(2)}</td>`;
          tableBody.appendChild(tr);
        });
        modal.dataset.type = type;
      }

      closeModal.addEventListener('click', ()=> modal.setAttribute('aria-hidden','true'));
      closeModalBtn.addEventListener('click', ()=> modal.setAttribute('aria-hidden','true'));
      modal.addEventListener('click', (e) => { if (e.target === modal) modal.setAttribute('aria-hidden','true'); });

      // Download CSV
      document.getElementById('downloadBtn').addEventListener('click', () => {
        if (!lastResults) return;
        const type = modal.dataset.type || 'flat';
        const sched = type === 'flat' ? generateFlatSchedule(lastResults) : generateReducingSchedule(lastResults);
        let csv = 'Month,EMI,Principal,Interest,Balance\n';
        sched.forEach(r => {
          csv += `${r.month},${r.emi.toFixed(2)},${r.principal.toFixed(2)},${r.interest.toFixed(2)},${r.balance.toFixed(2)}\n`;
        });
        const blob = new Blob([csv], { type: 'text/csv' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `emi_schedule_${type}.csv`;
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(a.href);
      });

      // Calculate button
      calculateBtn.addEventListener('click', calculateAll);

      // Keep inputs sane
      [onRoadEl, downEl, tenureEl, activeInput].forEach(el => {
        el.addEventListener('input', () => {
          if (el === downEl) clampDownPayment();
        });
      });

      // Pre-fill chips with sensible defaults for initial view
      chipEmi.textContent = '2539';
      chipReducing.textContent = '24.12';
      chipFlat.textContent = '13.5';

      // Make Enter key on active input trigger calculation
      activeInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') calculateAll();
      });

    })();
  </script>
</body>
</html>
